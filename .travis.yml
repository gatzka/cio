language: c

branches:
  except:
    - /^feature.*$/

sudo: false

env:
  matrix:
    - BUILD=gcc
    - BUILD=clang

script:
  - if [ "$COVERITY_SCAN_BRANCH" != 1 ]; then
      case ${BUILD} in
        gcc)
          mkdir build_release &&
          cd build_release &&
          cmake -DCMAKE_BUILD_TYPE=Release ../src/ &&
          make VERBOSE=1 &&
          mkdir ../build_debug &&
          cd ../build_debug &&
          cmake -DCMAKE_BUILD_TYPE=Debug ../src/ &&
          make VERBOSE=1&&
          make test
          ;;
        clang)
          mkdir build_release &&
          cd build_release &&
          cmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_TOOLCHAIN_FILE=../cmake/clang.cmake ../src/ &&
          make VERBOSE=1 &&
          mkdir ../build_debug &&
          cd ../build_debug &&
          cmake -DCMAKE_BUILD_TYPE=Debug -DCMAKE_TOOLCHAIN_FILE=../cmake/clang.cmake ../src/ &&
          make VERBOSE=1 &&
          make test
          ;;
      esac ;
    fi

addons:
  apt:
    sources:
    - ubuntu-toolchain-r-test
    packages:
    - gcc-6
    - clang
    - cmake
    - doxygen
    - valgrind

